计算机网络的核心是协议
从功能上，计算机网络由通信子网和资源子网组成

计算机网络的五大功能
数据通信，资源共享，分布式处理，提高可靠性，负载均衡
数据通信是最基本的功能，是实现其它功能的基础

按传输技术分，广播式网络和点对点网络
局域网采用广播式通信，无线、卫星也采用广播式

电路交换网络，建立一条专用的通路，包括建立连接、传输数据和断开连接三个阶段，典型的电路交换网是传统电话网络
优点是数据直接传送，时延小，缺点是利用率低，不便于进行差错控制

报文交换网络，又称存储转发网络，可以一对多、多对一，可以格式转换，可以差错控制，但是增大了资源开销，增加了缓冲时延，缓冲区难以管理

分组交换网络，也称包交换网络

带宽的单位是b/s，最高数据传输速率
时延，包括发送时延（传输时延），传播时延，处理时延，排队时延

时延带宽积，第一个bit到达终点时，发送端已经发出的bit数量，又称为以bit为单位的链路长度，等于传播时延*信道带宽

吞吐量，单位时间内通过某个网络的数据量，受带宽和额定速率的限制

速率，b/s

SAP服务访问点，第N层向第N+1层提供服务的地方，同一结点相邻两层的实体交互的地方
每个SAP都有一个能标识它的地址，SAP实际上是一个逻辑接口

报文分为两部分，SDU服务数据单元，PCI协议控制信息，合起来是PDU协议数据单元，是对等层之间传送的数据单位

协议的三部分：语法，语义，同步

服务原语：上层使用下层服务时必须与下层交换的命令，分为四类，请求，指示，响应，证实

物理层定义DTE数据终端设备和DCE数据通信设备的物理与逻辑连接方法

物理层协议：EIA-232C、EIA/TIA RS-449、CCITT的X.21

数据链路层的功能：成帧、差错控制、流量控制、传输管理

数据链路层协议：SDLC、HDLC、PPP、STP、帧中继

网络层协议：
IP、IPX、ICMP、IGMP、ARP、RARP、OSPF

OSI在网络层支持无连接和面向连接的通信，在传输层仅支持面向连接的通信
TCP/IP在网际层仅支持无连接的通信，在传输层支持无连接和面向连接的通信

电路交换，进行传输前必须先建立专用的物理通信路径

分组交换的两种方式：面向连接的虚电路和无连接的数据报

电路交换不提供差错控制，不能平滑网络通信量，不具备存储数据的能力

双绞线，屏蔽双绞线STP，非屏蔽双绞线UTP

同轴电缆，50Ω用于传送基带数字信号，称为基带同轴电缆，用于局域网，75Ω用于传送宽带信号，称为宽带同轴电缆，用于有线电视
有外导体屏蔽层

多模光纤，将入射角不同的光纤在一根光纤传输，只适合近距离传输

单模光纤，使光线一直向前传播而不反射，适合远距离传输

光纤保密性好，体积小重量轻，抗电磁干扰能力好

无线电波，所有方向，穿透能力较强

视线介质：红外线，微波，激光，都沿直线传播

物理层接口标准：EIA RS-232-C，ADSL，SONET/SDH

同轴电缆以太网使用广播的方式发送信息，所以是半双工的

同轴电缆的带宽更高得益于屏蔽性

物理层设备
中继器
集线器，是一个多端口的中继器，每个端口连接的网络是同一个网络的不同网段，只能在半双工下工作

以太网是无确认无连接的服务
无线通信是有确认无连接的服务

帧定界，帧同步，透明传输
透明传输是无论什么bit组合都应该能在链路层传输

OSI中数据链路层有流量控制的功能，TCP/IP中流量控制被移到了传输层

ARQ自动重传请求，前向纠错FEC

SLIP、PPP是数据链路层协议

SOH表示开始，EOT表示结束，ESC表示转义字符

0bit填充法，遇到连续5个1时自动插入一个0

违规编码法，适用于冗余编码环境

海明码纠错d位需要码距2d+1，检错d位需要码距d+1

带r个校验位的多项式编码可以检测到长度小于等于r的突发性错误

信道效率即信道的利用率，指发送方在一个发送周期T中，有效地发送数据所需的时间占整个发送周期的比率
设发送方从开始发送到收到第一个ACK为止的时间为一个发送周期T，发送方在这个周期内发送了L比特的数据，数据传输速率为C，则发送方发送数据所占的时间是L/C，信道效率为L/CT

信道吞吐率=信道效率*发送方的发送速率

FDM频分复用
TDM时分复用
STDM异步时分复用，采用STDM帧，不固定分配时隙，当有数据要传送时才分配时间片
WDM波分复用，光的频分复用
CDM码分复用，共享时间、空间
CDMA码分多址，码片向量

ALOHA，碰撞后随机等待，网络负载（即一段时间内要传送的的帧的数量）为G，则吞吐量为Gexp(-2G)
ALOHA的信道利用率是18.4%

时隙ALOHA，必须在一个slot开始时才能发送，吞吐量是Gexp(-G)，信道利用率是36.8%

CSMA载波侦听多路访问
1坚持CSMA，要发送时侦听信道，如果忙，持续侦听
非坚持CSMA，要发送时侦听信道，如果忙，等待一个随机间隔后侦听
p坚持CSMA，要发送时侦听信道，如果忙，持续侦听，如果空闲，以概率p发送数据，以概率1-p推迟到下一个时隙

CSMA/CD载波侦听+碰撞检测，适用于总线型网络或半双工环境
所有数据帧都要大于一个最小帧长，即两倍传播时延*数据传输速率
二进制指数退避，取争用期为两倍端到端时延2t，k=min(重传次数，10)，从[0,1,2,...,2^k-1]中随机取一个数r，重传需要退避的时间就是2*r*t
当重传16次仍不成功时，说明网络拥挤，抛弃此帧并向上层报告错误

CSMA/CD用于有线局域网

CSMA/CA载波侦听多路访问+碰撞避免，用于无线局域网
802.11使用链路层确认ARQ，只有收到确认时才发送下一帧
IFS帧间间隔，完成一次发送后，需要等待一个IFS才能发送下一帧
SIFS短IFS，分隔属于一次对话的帧，包括ACK，CTS，分片的数据帧和回答AP探寻的帧
PIFS点协调IFS，在PCF操作中使用
DIFS分布式协调IFS，最长的IFS，用于异步帧竞争访问的时延，在发送RTS预约前需要等待一个DIFS

802.11预约信道
源站先广播一个很短的RTS请求发送控制帧，若信道空闲，AP广播一个CTS允许发送控制帧

令牌传递协议

以太网的最小数据帧长度为64B，以太网帧的数据部分为1500B

数据链路层的两个子层，MAC媒体接入控制层和LLC逻辑链路控制层

三种局域网
以太网，逻辑拓扑是总线型，物理拓扑是星形或拓展星形
令牌环，逻辑拓扑是环形，物理拓扑是星形
FDDI光线分布数字接口，逻辑拓扑是环形，物理拓扑是双环

LLC向网络层提供四种不同的连接服务类型

以太网无连接，不对数据帧编号，不要求确认，以曼彻斯特编码

10BASE5，基带同轴电缆（粗缆），总线型，最大段长500m，最多结点数100
10BASE2，基带同轴电缆（细缆），总线型，最大段长185m，最多结点数30
10BASE-T，非屏蔽双绞线，星形，最大段长100m，最多结点数2
10BASE-FL，光线对（850nm），点对点，最大段长2000m，最多结点数2

BASE表示基带，曼彻斯特，T表示双绞线，F表示光纤，数字表示几百米

由于以太网大多数使用基带传输，所以使用中继器而不是放大器
5类UTP非屏蔽双绞线的最大长度是100m

网卡与局域网的通信是串行的，与计算机的通信是通过I/O总线并行的，网卡的一个功能是串并转换

MAC地址6字节，高24位是厂商代码

以太网V2格式
7B前同步码，1B帧开始定界符，6B源地址，2B类型（指出上层协议），46~1500B数据，CRC校验码4B，不校验前导码

802.3格式与以太网V2的不同支出在于用长度域替代了以太网中的类型域

100BASE-T，星形，全双工/半双工，在全双工下不使用CSMA/CD，100Mb/s基带信号，最大电缆长度100m，帧间间隔0.96μs

10Gbit以太网，不使用CSMA/CD，只使用光纤，只工作在全双工，没有争用

802.11是星形的，使用CSMA/CA

无线局域网的最小构建是BSS基本服务集，一个基本服务集包括一个AP接入点和若干移动站
SSID服务集标识符

802.11帧
MAC首部30B，数据部分最多2312B，FCS帧检验序列4B
MAC首部中，第4个地址用于自组网络
前三个地址，当去往AP为0，来自AP为1时，地址1=接收地址=目的地址，地址2=发送地址=AP地址，地址3是源地址
当去往AP为1，来自AP为0时，地址1=接收地址=AP地址，地址2=发送地址=源地址，地址3是目的地址

VLAN
802.3ac标准支持VLAN，在以太网帧中插入4B的VLAN标签，用来指明发送该帧的计算机属于哪个VLAN，帧称为802.1Q帧，最长帧长从1518B变为1522B
VLAN标签的前两个字节为0x8100，后两个字节中，前4bit无效，后12bit是该VLAN的VID，802.1Q帧的FCS必须重新计算

VLAN信息只在交换机之间传递，计算机不知道自己处于VLAN中，计算机与交换机交流的都是以太网帧，交换机之间才交换802.1Q帧

在使用静态地址的系统中，如果有重复的MAC地址，那么这两个设备都不能正常通信

IEEE802局域网标准对应OSI的物理层和数据链路层，其中数据链路层被分为LLC和MAC

快速以太网保持最短帧长不变，最大电缆长度减少到100m

Gbit以太网的物理层有两个标准，802.3z采用光纤，802.3ab采用4对UTP5类线

VLAN建立在交换技术的基础上，通过软件实现逻辑分组与管理，VLAN的计算机可以处于不同的局域网中

划分VLAN的方法，基于端口，基于MAC地址，基于IP地址

链路聚合解决交换机之间的宽带瓶颈问题

PPP使用串行线路通信，面向字节，分为三个部分：链路控制协议LCP，网络控制协议NCP，将IP数据报封装到串行链路的方法

PPP帧的前后各有1B的标志字段，地址字段占1B，规定为0xFF，控制字段占1B，规定为0x03，协议字段2B

PPP帧的数据部分最小为0，最大为1500B

PPP提供差错检测，但是不纠错，是不可靠的传输协议，不使用序号和确认

PPP只支持全双工，点对点

PPP两端可以运行不同的网络层协议

高级数据链路控制HDLC是面向比特的，使用编号和确认，提供可靠传输

PPP使用字符填充

PPP支持动态分配IP地址

交换机是一个多端口的网桥

VLAN可以隔离广播域

以太网帧最小是64B，直通交换只检查目的地址6B

10Mb/s以太网帧间间隙最小是9.6μs，100Mb/s最小是0.96μs

中继器要求两端速率相同，数据链路层协议也相同

网桥采用存储转发，以太网交换机还可以直通

ICMP是网络层协议

距离向量算法中，导致路由回路的根本原因是慢收敛

IPv4
4位首部长度，以4B为单位，常用的是20B
16位总长度，IP数据报的最大长度为65535B，包括首部和数据
16位标识，分片时使用
3位标志，MF是标志的最低为，MF=0表示最后一个分片，中间位DF，DF=0才允许分片
13位片偏移，以8B为单位
8位TTL生存时间
8位上层协议字段
16位首部检验和
4B+4B源目的地址字段

主机号全为0表示网络
主机号全为1表示本网络的广播地址，称为直接广播地址
127.x.x.x为环回自检
0.0.0.0表示本网络上的本主机
255.255.255.255表示整个TCP/IP网络的广播地址，称为受限广播地址，实际使用时等效为本网络的广播地址

私有IP地址段
10.0.0.0-10.255.255.255
172.16.0.0-172.31.255.255
192.168.0.0-192.168.255.255

A类地址
1.x.x.x-126.x.x.x
B类地址
128.0.x.x+191.255.x.x
C类地址
192.0.0.x-223.255.255.x

在经典ABC划分法中，子网号不能全为0或全为1，在CIDR中可以

路由聚合
将网络前缀相同的连续IP地址组成块，一个CIDR地址块可以表示很多地址

ARP工作在网络层

DHCP是应用层协议，基于UDP
发现，提供，请求，确认

ICMP差错报告和ICMP询问

ping工作在应用层，直接使用ICMP的回送请求和回答报文，没有使用传输层的服务
Traceroute/Tracert工作在网络层

组播分组不产生ICMP差错报文

RARP，通过自己的MAC向网关请求IP

CIDR的作业是把小的网络汇聚成大的超网

NAT表项需要管理员手动添加，不会自动添加，表里没有的项目就不转发

IPv6支持QoS，但没有校验和字段

RIP路由信息协议，基于距离向量

RIP定期交换路由表

RIP允许最多15跳，当距离等于16时，表示网络不可达

RIP是应用层协议，使用UDP，端口520

OSPF开放最短路径优先

OSPF是网络层协议，直接用IP数据报传送，协议字段为89

只有在链路状态变化时，路由器才洪泛发送信息，收敛快，不会出现RIP坏消息传得慢的问题

OSPF可以根据IP分组的不同服务类型设置不同的代价，且具有多路负载平衡

OSPF路由器之间交换的分组有鉴别功能

OSPF五种分组
问候，数据库描述，链路状态请求，链路状态更新，链路状态确认

BGP边界网关协议，路径向量，鱼距离向量和链路状态都不同
BGP是基于TCP的应用层协议

BGP-4四种报文
Open报文用来与另一个BGP发言人建立关系
更新报文用来发送某一路由的信息和列出要撤销的路由
Keepalive报文，确认打开报文
通知报文，发送检测到的差错

IP组播一定使用UDP，使用D类地址空间

IGMP网络组管理协议，通知路由器要接收发送给某个组的分组

IP组播的地址范围
224.0.0.0~239.255.255.255
前4位是1110

组播地址只能用于目的地址，不能用于源地址

组播数据报不产生ICMP差错报文

MAC组播地址只有23位，而D类IP地址有28位可供分配，因此可能存在两个不同的IP组播地址对应相同的MAC组播地址，还需要在IP层判断收到的组播数据报是不是需要的

MAC组播地址的第25位是0，即IP地址的第9位是0

距离向量组播，链路状态组播，协议无关的组播

服务器端口号：1024-49151，称为登记端口号

FTP控制连接的端口是21，数据连接的端口是20

TELNET的端口是23

SMTP的端口是25

UDP首部8B，TCP首部20B

UDP首部长度字段包括首部和数据，不包括伪首部，最小值是8，即仅有首部

校验和全0表示不校验

12B伪首部包括源IP和目的IP和UDP长度
末尾添0凑16位字

UDP检测出错误可以上交，但要附上错误报告

如果UDP检验和恰好为0，就置为全1

UDP在不需要对方回信时源端口号可为0

TCP的首部是4B的倍数，默认20B，最大为60B

4B序号，按字节编序，指的是本报文段第一个字节的序号

4B确认号，希望接收到下一个报文段的第一个字节的序号

2B窗口

2B校验和，也有12B伪首部

紧急指针和紧急位

IP协议字段17代表UDP，6代表TCP

以太网开销26B，18B首部和尾部，7B前同步码，1B帧开始定界符

快速以太网数据帧有效载荷最小是4B

发送窗口取拥塞窗口和接收窗口的最小值

四次挥手
客户端提出断开连接，发送FIN=1、seq=u，进入FIN_WAIT_1
服务器收到发ACK=1，ack=u+1，进入CLOSE_WAIT，客户端收到ACK后进入FIN_WAIT_2
服务器要结束的时候发送FIN=1，ACK=1，ack=u+1，进入LAST_ACK，注意两个ACK是一样的
客户端收到之后发ACK=1，seq=u+1，进入TIME_WAIT等待2MSL后CLOSE
如果2MSL里服务器没有收到ACK，就会重发FIN，这时候客户端会重置2MSL
服务器收到之后CLOSE

计算平均RTT时，只要报文段重传了，就不将其作为样本，且每重传一次就把RTO超时重传时间增大一些

域名不区分大小写，除了连字符-外不能有其它标点符号

域名的单个标号不超过63个字符，完整域名不超过255个字符

arpa是顶级域名，用于反向域名解析

根DNS，顶级DNS，授权DNS，本地DNS

根DNS管理顶级域，告诉客户应该找哪个顶级域名服务器进行查询

FTP数据连接
主动模式PORT，被动模式PASV

DNS端口53

FTP控制端口21数据端口20

NFS网络文件系统

MIME多用途网际邮件扩充
MIME把用户的非ASCII码编码成ASCII码

SMTP端口25

250 OK，550 No such user here，354 Start mail input

POP3端口110，使用明文传输密码，只能传输ASCII码，除非使用MIME

IMAP

URL不区分大小写

HTTP使用TCP，但HTTP本身是无连接无状态的

HTTP1.1使用流水线的持续连接

TELNET TCP 23
TFTP UDP 69
SNMP UDP 161

HEAD方法
服务器对HTTP报文响应，但不返回请求对象











DSL数字用户线，ISP是本地的电话公司
高速下行信道，位于50kHz到1MHz频段；
中速上行信道，位于4kHz到50kHz频段；
普通的双向电话信道，位于0到4kHz频段

电缆因特网接入，有线电视公司，同轴电缆，混合光纤同轴系统

FTTH光纤到户

电路交换，预留资源
频分复用，频段的宽度称为带宽

处理时延
检查分组首部，决定将分组导向何处，检查差错
排队时延
在链路上等待传输
传输时延
L/R
传播时延
物理媒介，距离
其他时延
如语音通话的编码、解码

a为分组数量
La/R流量强度，不能大于1

吞吐量
主机接收到文件的速率，单位bps

弱点攻击，带宽洪泛，连接洪泛，IP哄骗

HTTP超文本传输协议：80端口
HTTP是一个无状态协议
持续连接和非持续连接
往返时间RTT

请求报文
1行请求行：方法字段，URL字段，HTTP版本字段
方法字段GET POST HEAD PUT DELETE
首部行
HOST: 对象所在主机
Connection: close非持续连接
User-agent: 用户代理，即浏览器类型
Accept-language: 语言版本
实体体
GET时实体体为空，POST时使用该实体体
HEAD不返回请求对象，PUT允许用户上传对象
DELETE允许用户删除服务器上的对象

响应报文
1行状态行：协议版本字段，状态码，相应状态信息
状态码包括200请求成功，404
6个首部行
Connection: close发送完报文后关闭该TCP连接
Date: 服务器检索到对象并插入响应报文的时间
Server: 指示服务器，类似User-agent
Last-Modified: 对象创建或最后修改的时间
Content-Length: 被发送对象的字节数
Content-Type: 对象的类型，如是HTML文本还是JPEG对象
实体体
包含请求的对象本身

cookie
在HTTP的请求中有一个cookie首部行，第一次访问时的响应报文中有一个Set-cookie首部行
在用户端系统中有一个cookie文件，由浏览器管理
在Web站点的后端数据库有一个cookie组件

条件GET
在GET中包含一个If-Modified-Since: 首部行，记录本地存储对象的时间
条件GET一般由Web缓存器发送给服务器，若未被修改过，服务器将返回不带对象的响应报文

内容分发网络CDN

用户代理，邮件服务器，SMTP
SMTP简单邮件传输协议：25端口
使用SMTP前要先将多媒体数据编码为ASCII码，收到邮件后要先解码，HTTP不用
SMTP和持续的HTTP都使用持续连接
HTTP主要是一个拉协议，SMTP主要是一个推协议
HTTP把每个对象封装到响应报文中，SMTP把所有对象放在一个报文中

SMTP每个首部必须包含一个From和一个To首部行
首部后是一个空白行，然后是以ASCII格式表示的报文体

POP3邮局协议：110端口
特许阶段：user <user name>命令和pass <password>命令
事务处理阶段：list命令、retr命令、dele命令

IMAP因特网邮件访问协议
IMAP允许用户代理获取报文的某些部分，如只读取一个报文的首部

基于web的电子邮件通过HTTP通信，然而在邮件服务器之间传输时，使用的仍然是SMTP

DNS域名系统：53端口
DNS是一个由分层的DNS服务器实现的分布式数据库
DNS还是一个使得主机能够查询分布式数据库的应用层协议
用户主机上运行着DNS应用的客户端
DNS还提供主机别名服务，获取主机别名对应的规范主机名
邮件服务器别名，MX记录允许邮件服务器和Web服务器使用相同的主机别名
负载分配，DNS在冗余的服务器之间进行负载分配，返回时循环IP地址次序

根DNS服务器，顶级域DNS服务器，权威DNS服务器
本地DNS服务器属于ISP，又叫默认名字服务器
DNS缓存在一段时间后会被丢弃

DNS记录
DNS服务器存储了资源记录RR，提供了主机名到IP的映射
每个DNS回答包含了一条或多条RR
四元组(Name, Value, Type, TTL)
TTL是该记录的生存时间，决定了从DNS缓存中将其删除的时间
Type = A，则Name是主机名，Value是IP
Type = NS，则Name是域，Value是该域的权威DNS服务器的主机名
Type = CNAME，则Value是别名为Name的主机的规范主机名
Type = MX，则Value是别名为Name的邮件服务器的规范主机名

DNS报文
12字节首部，标识符2字节，用于标识一个查询，1位回答标志位，指出是查询报文0还是回答报文1，1位权威标志位，当一个DNS服务器是所请求名字的权威DNS服务器时，该标志位在回答报文中被置1，希望递归标志位，由客户置1
问题区域包括名字字段和类型字段，回答区域包括了对最初请求的名字的RR，可以包含多条RR
权威区域包括了其他权威服务器的记录，附加区域包括了其他有帮助的记录

注册登记机构将一个类型NS和一个类型A的记录输入权威DNS服务器

网络层提供了主机间的逻辑通信，运输层提供了进程间的逻辑通信

UDP用户数据报协议，UDP提供进程到进程的数据交付和差错检查两种服务

将主机间交付扩展到进程间交付称为运输层的多路复用与多路分解

TCP提供可靠数据传输和拥塞控制

使用UDP
UDP关于发送数据和何时发送的控制更为精细
无需建立连接，没有建立连接的时延，也无须维护连接状态
分组首部开销小，TCP首部20字节，UDP首部8字节

但分组丢包率低时，且为了安全原因，某些机构可能阻塞UDP流量，这使得TCP对视频流式传输也有吸引力

UDP有4字节的源端口号和目的端口号首部字段，还有长度字段和检验和字段，长度以字节为单位，指明整个UDP报文段的长度
实际上计算检验和时，还包括IP首部的一些字段

ARQ自动重传请求协议
差错检测，接收方反馈，重传

序号字段

比特交替协议

GBN回退N步协议，或滑动窗口协议，N被称为窗口长度

SR选择重传协议
窗口长度必须小于或等于序号空间大小的一半

重新排序问题
等待足够长的时间如3分钟后再使用该序号

MSS最大报文段长度，通常根据最大链路层帧长度MTU来设置

TCP首部包括源端口号和目的端口号，包括检验和字段，此外还包括
4字节序号字段，4字节确认号字段
2字节接收窗口字段，用于流量控制
4位首部长度字段，单位是4字节，当为空的时候TCP首部长20字节
选项字段
6位标志字段，包括ACK确认，RST, SYN, FIN用于连接的建立和拆除
PSH表示接收方应立即将数据上交，URG表示紧急，紧急数据的最后一字节由16位的紧急数据指针字段指出，这三个在实践中并未使用

序号是该报文段首字节的字节流编号，确认号是期待收到对方的下一个字节的编号

TCP
源端口2B 目的端口2B 序号4B 确认号4B 数据偏移4b 保留字段6b
紧急位URG 确认位ACK 推送位PSH 复位位RST 同步位SYN 终止位FIN
窗口字段2B 校验和2B 紧急指针2B 选项字段 填充字段

数据偏移的单位是4B
URG=1表示紧急指针有效
TCP建立连接后所有传送的报文段都必须把ACK置1
RST=1必须释放连接再重新建立连接

累积确认

超时间隔加倍，快速重传

拥塞代价
分组的到达速率接近链路容量时，分组经历巨大的排队时延
发送方必须执行重传以补偿丢弃的分组
发送方遇到大时延时进行不必要的重传占用链路带宽
上游路由器所使用的传输容量在该分组被丢弃时被浪费了

端到端拥塞控制，网络辅助的拥塞控制

慢启动，拥塞避免，快速恢复
超时时，结束慢启动
慢启动阈值设为上次拥塞时最大拥塞窗口的一半
当检测到3个冗余ACK，执行快速重传并进入快速恢复状态
当达到慢启动阈值时，每个RTT增加一个MSS的拥塞窗口
超时时，结束拥塞避免，拥塞窗口被设为1个MSS
收到3个冗余ACK时，拥塞避免将拥塞窗口的值减半，将慢启动阈值设为拥塞窗口的一半，然后进入快速恢复状态
对引起快速恢复的每个报文段，收到的每个冗余ACK都增加一个MSS的拥塞窗口，当丢失报文段的一个ACK到达时，降低拥塞窗口并进入拥塞避免状态，如果出现超时，则进入慢启动状态

ECN明确拥塞通告
在IP数据报首部的服务类型字段设置ECN位，当发送方接收到带ECN位的ACK时，减半拥塞窗口，就像快速重传一样
DCCP数据报拥塞控制协议

转发和路由选择，数据平面和控制平面

路由器转发的四个组件，输入端口，输出端口，交换结构，路由选择处理器

经内存交换，经总线交换，经互联网络交换

输入排队的前部阻塞，即输出端口无竞争的情况下，由于分组前面的分组被阻塞，也不能被交换结构处理

主动队列管理，在路由器缓存填满之前就丢弃分组，向发送方提供拥塞信号

输出端口排队

分组调度
先进先出，优先权排队
非抢占式优先权排队，传输不能被打断
循环排队，加权公平排队

IPv4数据报的首部一般为20字节
4位版本号，4位首部长度
服务类型，如实时或非实时
16位数据报长度，包括首部长度，以字节计，理论最大长度为65535，但实际一般不超过1500字节
标识，标志，片偏移，与IP分片有关，但IPv6不允许分片
寿命TTL
协议字段，表明交给哪个运输层协议
首部检验和，每台路由器必须都计算检验和并重写，因为TTL字段或选项字段可能会改变，只对IP首部计算

重复进行差错检测，因为上层协议和下层协议不一定同属于一个协议栈

源IP和目的IP，目的IP是最终目的地

选项字段，IPv6中没有

IP数据报分片的重新组装工作放在端系统中

同一个数据报的分片的标识相同，最后一片的标志是0，其他是1，偏移指定放在哪个位置

每个接口都有一个IP地址

CIDR无类别域间路由选择

地址聚合或路由聚合或路由摘要，使用单个网络前缀通告多个网络
最长前缀匹配

分类编址
广播地址255.255.255.255

默认网关，第一跳路由器的地址

transaction ID，发现和提供一对，请求和ACK一对
DHCP发现，广播地址，源IP是0.0.0.0
DHCP提供，广播地址
DHCP请求，广播地址
DHCP ACK，广播地址

NAT网络地址转换
NAT转换表

IPv6
128位地址，任播地址，将数据报交付给任意一个主机
40字节定长首部
20位flow流标签字段
版本字段为6
8位流量类型
2字节有效载荷长度，单位为字节
下一个首部
跳限制

IPv6不允许分片和组装，去掉了首部检验和

OpenFlow流表
表项包括首部字段值的集合，计数器集合，动作集合
动作可能是转发，丢弃或修改字段
均衡负载，充当防火墙

每路由器控制，逻辑集中式控制
每台路由器的控制代理CA

集中式路由选择算法，链路状态LS算法
分散式路由选择算法，距离向量DV算法

LS算法拥塞敏感，震荡，避免自同步，发送通告的时间随机化

DV算法迭代，异步，分布式，BF方程
无穷计数问题，增加毒性逆转，即z向y通告z到x的距离是∞，避免y选择发给z再给x
毒性逆转检测不到3个节点以上的环路

OSPF开放最短路优先，LS算法
规模和管理自治
AS自治系统

OSPF安全，可选择多条相同开销的路径，支持单播和多播，支持单个AS中的层次结构

BGP边界网关协议，分布式，异步，DV算法
从邻居AS获得前缀的可达性信息，确定到该前缀的最好的路由
如果一台路由器在BGP通告路径列表中看到了包含它自己的AS，将拒绝此通告

热土豆路由选择，尽快送出AS
BGP算法，本地偏好，最短AS路径，即AS跳数，热土豆

IP任播，选择最近的服务器
CDN公司为多台服务器指派相同的IP地址，使用BGP通告该IP，当某路由器收到该IP的多个路由通告，将提供不同的路径，每台路由器将本地化使用BGP选择最好的路由
然而这可能导致相同的TCP连接的不同分组到达不同的Web服务器
IP任播被广泛用于DNS，将DNS请求指向最近的根DNS服务器

策略，规模，性能
规模，OSPF总能分成多个AS

SDN
基于流的转发，数据平面与控制平面分离，网络控制功能位于数据平面外部，可编程网络

OpenFlow运行在TCP上

ICMP因特网控制报文协议
差错报告，目的网络不可达
ICMP承载在IP分组中，IP指明上层协议为ICMP
ICMP很少使用的拥塞控制：源抑制报文

SNMP简单网络管理协议

链路层提供的服务可能有
成帧，链路接入即多路访问问题，可靠交付，差错检测和纠正

MAC媒体访问控制

PPP点对点协议

信道划分协议，频分，时分，CDMA码分多址

随机接入协议
时隙ALOHA，效率1/e
ALOHA，失败后以概率p立即重传，不同步，效率1/2e
CSMA载波侦听多路访问
二进制指数后退，经历了n次碰撞后，随机选择一个间隔K

轮流协议
轮询协议，主节点询问每个节点，告诉其可以传输的帧的最大数量
令牌传递协议，令牌帧在节点间以某种固定次序交换，如果令牌节点故障，会使整个信道崩溃

ARP地址解析协议
6字节MAC地址
MAC地址是扁平结构的
MAC广播地址
ARP表
发送方构造ARP分组，广播该分组
ARP响应不广播，因为目的MAC已知
ARP是一个网络层协议，也是一个链路层协议

发送数据到子网外，目的MAC是第一跳路由器的MAC，然后是转发出口的MAC

以太网使用CSMA/CD
集线器放大广播每一个bit，但集线器同时收到帧的时候会碰撞

以太网帧
前同步码，同步时钟
类型字段，指明网络层协议，ARP分组也在此标明
4字节CRC

对于交换机表中没有的MAC地址，交换机广播该帧
对于等于输入接口的MAC地址，丢弃过滤
对于不等于输入接口的MAC地址，转发

交换机自学习
对于每个入帧，存储该帧的源MAC，该帧到达的接口，当前时间
如果没有在稍后收到以该MAC为源的帧，删除该地址

交换机能消除碰撞，链路隔离，网络管理

虚拟局域网
交换机的端口被划分为组，每个组构成一个虚拟局域网
VLAN之间通过路由器转发通信
802.1Q帧在标准以太网帧中加入4字节VLAN标签首部，标明一个帧通过干线时属于哪个VLAN

路径损耗，其他源干扰，多径传播
隐藏终端问题，衰减

CDMA码分多址是信道划分协议

SSID服务集标识符

AP接入点
被动扫描
AP周期性地发送信标帧，包括AP的SSID和MAC
主动扫描
向所有AP广播探测请求帧，AP将给出一个探测响应帧
向选定的AP发送关联请求帧，AP给出关联响应帧
向AP发送DHCP发现报文

CSMA/CA
802.11使用ARQ确认重传
不使用碰撞检测，而是碰撞避免
链路层确认，当通过CRC校验后，等待短帧间间隔，发回确认帧
如果发送站点未收到确认帧，将重传

监听到信道空闲时，在一个分布式帧间间隔后发送帧
否则选取一个随机回退值，当信道空闲时递减该值，忙时不变
当计数值被减为0时发送整个帧并等待确认，否则进入回退阶段，从更大的范围选取随机值

处理隐藏终端
RTS请求发送控制帧，CTS允许发送控制帧
广播RTS帧，CTS帧
仅用于长数据帧预约信道

点对点
定向天线

四个地址
AP是链路层设备，不理解IP地址，但对路由器而言，路由器不知道AP的存在
源MAC，目的MAC
AP将802.3帧转换成802.11帧，其中源MAC被写成AP的MAC，在地址3填上路由器的入口MAC
即地址3是路由器的MAC
地址4是自组织网络使用的

序号，持续期（预约信道时间）

如果连接两个AP的是一个交换机，则可以在切换BSS时保持IP地址和TCP连接
如果连接两个AP的是路由器，则会断开TCP连接

当切换AP时，新AP将以主机的MAC作为源MAC向交换机发送广播帧，使其更新转发表

速率适应
功率管理，向AP发送自己要睡眠，AP在发送帧之前先发送信标帧唤醒该节点，信标帧中列出了要发送的帧的列表

802.15无线个人域网络，自组织网络
时分复用，2.4GHz
蓝牙轮询？
蓝牙有主设备和从设备，可休眠

4G
LTE长期演进互联网
全IP核心网，语音和数据都在IP数据报中

一个移动节点的永久居所称为归属网络，当前所在网络是外部网络或被访网络，在归属网络中执行移动管理的实体是归属代理，当前所在网络中执行移动管理的实体是外部代理
外部代理将为移动节点创建一个转交地址COA，然后告诉其归属代理

间接路由选择
通信者将数据报寻址到移动节点的固定地址，归属代理截获数据报，然后将该数据报封装，再转发给外部代理，外部代理拆封后再发给移动节点

直接路由选择克服三角路由
通信者代理向归属代理获取移动节点的COA，由通信者代理执行归属代理的封装转发

移动用户定位协议，以便通信者代理向归属代理查询COA
当移动节点移动时，新外部代理向锚外部代理发送新COA，锚外部代理使用该新COA封装数据并转发给移动节点

移动IP
代理发现，向归属代理注册，间接路由选择

代理发现
代理通告，外部代理或归属代理使用ICMP广播报文
代理请求，移动节点广播代理请求ICMP报文，代理将向其单播一个代理通告

向归属代理注册
收到代理通告后，向外部代理发送一个UDP的移动IP注册报文，包含节点的永久地址，归属代理的地址，一个由外部代理通告的COA
外部代理将查找这样的数据报，其封装了一个目的地址与节点的永久地址匹配的数据报
外部代理向归属代理发送移动IP注册报文
归属代理检查请求，绑定COA和永久IP，并响应
外部代理接收响应，并发回移动节点

无线网络的差错对高层协议的影响
ARQ本地恢复
TCP发送方知晓无线链路
分离连接，被打断为两个运输层连接，一个从移动节点到无线AP，另一个从无线AP到有线通信者，前者可以是带差错恢复的定制UDP，也可以是TCP
